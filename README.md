# Bosh OpenSSL plugin
Bosh CLI plugin to retrieve, or generate and store, RSA keys, self-signed certificates, and random password at deploy time.

## Why you should care

Generally BOSH operators store secrets in plaintext in their BOSH manifests like this:

```yaml
properties:
  admin_password: TXCn0Vv3QWQFn1Ik+8IIfw==
  cert: |
    -----BEGIN CERTIFICATE-----
    MIIDhzCCAm+gAwIBAgIBADANBgkqhkiG9w0BAQUFADA6MQswCQYDVQQGEwJCRTEN
    MAsGA1UECgwEVGVzdDENMAsGA1UECwwEVGVzdDENMAsGA1UEAwwEVGVzdDAeFw0x
    NjA1MDYxNTUyNDNaFw0yNjA1MDQxNTUyNDNaMDoxCzAJBgNVBAYTAkJFMQ0wCwYD
    VQQKDARUZXN0MQ0wCwYDVQQLDARUZXN0MQ0wCwYDVQQDDARUZXN0MIIBIjANBgkq
    hkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA05YhPcD7+FWysWeKFXSHnqmWnL+hKUbh
    ...snip...
```

Its just a matter of time before this gets commited to a public GitHub repo...

Use `bosh-openssl` to break this bad habit and just commit this:

```yaml
  properties:
    my_secret: <%= get_password 'my_password' %> 
    cert: <%= get_certificate 'my_cert', 'my_key', '*.example.com' %>
```

which pulls the secrets into the manifest at `bosh deploy` time from `~/.bosh/openssl`
or [Vault](https://www.vaultproject.io/).

AND saves you the hassle of having to generate the secrets in the first place.

Remember, friends don't let friends store secrets in plaintext...

## How to install
```
gem install bosh-openssl
```

## How to use

In your BOSH manifest, use the `get_*` helpers to fetch openssl "secrets" from the `~/.bosh/openssl` folder.

The first time `get_*` is called it will generate and store the "secret".

If you have a valid `VAULT_ADDR` environment variable defined; secrets will be stored 
in your [Vault](https://www.vaultproject.io/) rather than on your file system

```yaml
  properties:
    my_secret: <%= get_password 'my_password' %> 
    private_key: <%= get_private_key 'my_key' %>
    public_key: <%= get_public_key 'my_key' %>
    cert: <%= get_certificate 'my_cert', 'my_key', '*.example.com' %>
    cert_with_key: <%= get_certificate_and_key 'my_cert', 'my_key', '*.example.com' %>
```

## Contributing

1. Fork it
2. Create your feature branch (`git checkout -b my-new-feature`)
3. Commit your changes (`git commit -am 'Add some feature'`)
4. Push to the branch (`git push origin my-new-feature`)
5. Create new Pull Request

## Notes

Generated by [BOSH plugin generator](https://github.com/Altoros/bosh-plugin-generator)
